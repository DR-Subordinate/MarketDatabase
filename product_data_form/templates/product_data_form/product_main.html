{% extends "product_data_form/base.html" %}

{% block content %}
  <section>
    <h1 class="text-3xl text-center font-bold my-2">
      {{ market.name}} {{ market.date}}
    </h1>
    <form method="post" id="product_form" enctype="multipart/form-data">
      {% csrf_token %}
      {{ new_formset.management_form }}
      <h2 class="text-3xl text-center font-bold mb-2 cursor-pointer" id="save_product_header">
        商品を登録
        <span class="text-blue-500">+</span>
      </h2>
      <div class="grid grid-cols-10 gap-2 mb-8 hidden" id="save_product_container">
        {% for form in new_formset %}
          {{ form.id }}
          <div class="p-1">
            {{ form.number.errors }} {{ form.number }}
          </div>
        {% endfor %}
      </div>

      {{ edit_formset.management_form }}
      <h2 class="text-3xl text-center font-bold mb-2 cursor-pointer" id="edit_product_header">
        商品を編集
        <span class="text-blue-500">+</span>
      </h2>
      <table class="table-fixed w-full mb-8 mx-auto border border-black hidden" id="edit_product_container">
        <thead>
          <tr class="bg-gray-300">
            <th class="border border-black">画像</th>
            <th class="border border-black">番号</th>
            <th class="border border-black">ブランド名</th>
            <th class="border border-black">商品名</th>
            <th class="border border-black">型番</th>
            <th class="border border-black">製造番号</th>
            <th class="border border-black">素材・カラー</th>
            <th class="border border-black">状態</th>
            <th class="border border-black">詳細・備考</th>
            <th class="border border-black">値段</th>
            <th class="border border-black">落札価格</th>
          </tr>
        </thead>
        <tbody>
          {% for form in edit_formset %}
            <tr>
              {{ form.id }}
              <td class="p-1 border border-black overflow-hidden">
                {% if form.instance.image %}
                  <img src="{{ form.instance.image.url }}" alt="商品画像" class="w-14 h-14">
                {% endif %}
                {{ form.image.errors }} {{ form.image }}
              </td>
              <td class="p-1 border border-black overflow-hidden">
                {{ form.number.errors }} {{ form.number }}
              </td>
              <td class="p-1 border border-black overflow-hidden">
                {{ form.brand_name.errors }} {{ form.brand_name }}
              </td>
              <td class="p-1 border border-black overflow-hidden">
                {{ form.name.errors }} {{ form.name }}
              </td>
              <td class="p-1 border border-black overflow-hidden">
                {{ form.model_number.errors }} {{ form.model_number }}
              </td>
              <td class="p-1 border border-black overflow-hidden">
                {{ form.serial_number.errors }} {{ form.serial_number }}
              </td>
              <td class="p-1 border border-black overflow-hidden">
                {{ form.material_color.errors }} {{ form.material_color }}
              </td>
              <td class="p-1 border border-black overflow-hidden">
                {{ form.condition.errors }} {{ form.condition }}
              </td>
              <td class="p-1 border border-black overflow-hidden">
                {{ form.detail.errors }} {{ form.detail }}
              </td>
              <td class="p-1 border border-black overflow-hidden">
                {{ form.price.errors }} {{ form.price }}
              </td>
              <td class="p-1 border border-black overflow-hidden">
                {{ form.winning_bid.errors }} {{ form.winning_bid }}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </form>
  </section>
  <input type="submit" name="save" form="product_form" value="保存" class="cursor-pointer text-white bg-blue-600 rounded p-1 fixed bottom-9 left-14">

  <script>
    const productForm = document.getElementById("product_form");
    productForm.addEventListener("keydown", e => {
      if (e.key === "Enter" && e.target.tagName !== "TEXTAREA") {
        e.preventDefault();
      }
    });

    const saveProductHeader = document.getElementById("save_product_header");
    const saveProductHeaderText = document.querySelector("#save_product_header > .text-blue-500");
    const saveProductTable = document.getElementById("save_product_container")
    saveProductHeader.addEventListener("click", () => {
      if (saveProductHeaderText.textContent === "+") {
        saveProductHeaderText.textContent = "−";
        saveProductTable.classList.toggle("hidden");
      } else {
        saveProductHeaderText.textContent = "+";
        saveProductTable.classList.toggle("hidden");
      }
    });

    const editProductHeader = document.getElementById("edit_product_header");
    const editProductHeaderText = document.querySelector("#edit_product_header > .text-blue-500");
    const editProductTable = document.getElementById("edit_product_container")
    editProductHeader.addEventListener("click", () => {
      if (editProductHeaderText.textContent === "+") {
        editProductHeaderText.textContent = "−";
        editProductTable.classList.toggle("hidden");
      } else {
        editProductHeaderText.textContent = "+";
        editProductTable.classList.toggle("hidden");
      }
    });
  </script>
{% endblock %}
